<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - FYCS Notes Hub</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/mobile.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <div class="admin-wrapper">
        <aside class="sidebar glass-block">
            <h1 class="sidebar-title">Admin</h1>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-link active">Dashboard</a>
                <a href="#upload" class="nav-link">Upload Notes</a>
                <a href="#manage" class="nav-link">Manage Notes</a>
                <a href="#subjects" class="nav-link">Manage Subjects</a>
                <a href="#cards" class="nav-link">Card Manager</a>
                <a href="#" onclick="logout()" class="nav-link">Logout</a>
            </nav>        </aside>

        <main class="admin-main">
            <div class="back-button-container" style="padding: 0 20px; margin-bottom: 20px;">
                <a href="index.html" class="circular-back-button" title="Back to Home">‚Üê</a>
            </div>
            <section id="dashboard" class="admin-section">
                <h2 class="admin-heading">Admin Dashboard</h2>
                <div class="dashboard-stats">
                    <div class="stats-card">
                        <h3>Total Notes</h3>
                        <div class="stat-number" id="total-notes">0</div>
                    </div>
                    <div class="stats-card">
                        <h3>Subjects</h3>
                        <div class="stat-number" id="total-subjects">0</div>
                    </div>
                    <div class="stats-card">
                        <h3>Uploads This Month</h3>
                        <div class="stat-number" id="uploads-month">0</div>
                    </div>
                    <div class="stats-card">
                        <h3>Most Active Subject</h3>
                        <div class="stat-number" id="most-active-subject">-</div>
                    </div>
                </div>
                <div class="recent-uploads">
                    <h3>Recent Uploads</h3>
                    <div id="recent-uploads-list"></div>
                </div>
            </section>

            <section id="upload" class="admin-section" style="display: none;">
                <h2 class="admin-heading">Upload Notes</h2>
                <div class="loader" id="upload-loader"></div>
                <div class="glass-block upload-form-container">
                    <form id="upload-note-form">
                        <div class="input-group">
                            <label for="subject-select">Subject:</label>
                            <select id="subject-select" required>
                                <option value="">Select a Subject</option>
                                <optgroup label="Theory">
                                    <option value="oop">OOP</option>
                                    <option value="cc">Cloud Computing</option>
                                    <option value="algo">Algorithms</option>
                                    <option value="minor">Minor Project</option>
                                    <option value="mm2">MM-II</option>
                                    <option value="evs">EVS</option>
                                    <option value="hrm">HRM</option>
                                    <option value="hindi">Hindi</option>
                                </optgroup>
                                <optgroup label="Practical">
                                    <option value="python">Python</option>
                                    <option value="oop-practical">OOP Practical</option>
                                    <option value="algo-practical">Algorithms Practical</option>
                                    <option value="webdev">Web Development</option>
                                </optgroup>
                            </select>
                            <div class="error-message" id="subject-error"></div>
                        </div>
                        <div class="input-group">
                            <label for="note-title">Title:</label>
                            <input type="text" id="note-title" placeholder="Enter note title" required>
                            <div class="error-message" id="title-error"></div>
                        </div>
                        <div class="input-group">
                            <label for="note-file">Upload PDF:</label>
                            <div class="drop-zone" id="drop-zone">
                                <p>Drag & drop your PDF here or click to browse</p>
                                <input type="file" id="note-file" accept="application/pdf" required style="display: none;">
                            </div>
                            <div class="error-message" id="file-error"></div>
                        </div>
                        <div class="preview-container" id="preview-container" style="display: none;">
                            <h4>PDF Preview:</h4>
                            <iframe id="pdf-preview" frameborder="0"></iframe>
                        </div>
                        <button type="submit" class="neon-button">
                            <span class="button-text">Upload Note</span>
                            <div class="loader loader-inline" id="upload-button-loader" style="display: none;"></div>
                        </button>
                    </form>
                </div>
            </section>

            <section id="manage" class="admin-section" style="display: none;">
                <h2 class="admin-heading">Manage Notes</h2>
                <div class="loader" id="manage-loader"></div>
                <div class="glass-block manage-notes-container">
                    <div class="search-filter-container">
                        <input type="text" id="search-input" placeholder="Search by title or subject">
                        <select id="sort-by">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                        <select id="filter-subject">
                            <option value="all">All Subjects</option>
                            <option value="oop">OOP</option>
                            <option value="cc">Cloud Computing</option>
                            <option value="algo">Algorithms</option>
                            <option value="minor">Minor Project</option>
                            <option value="mm2">MM-II</option>
                            <option value="evs">EVS</option>
                            <option value="hrm">HRM</option>
                            <option value="hindi">Hindi</option>
                            <option value="python">Python</option>
                            <option value="oop-practical">OOP Practical</option>
                            <option value="algo-practical">Algorithms Practical</option>
                            <option value="webdev">Web Development</option>
                        </select>
                    </div>
                    <table class="notes-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Subject</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="manage-notes-table-body">
                            <!-- Notes will be loaded here -->
                        </tbody>
                    </table>
                    <div class="pagination" id="pagination">
                        <button id="prev-page">Previous</button>
                        <span class="current-page" id="current-page">1</span>
                        <button id="next-page">Next</button>
                    </div>
                </div>
            </section>
            
            <section id="subjects" class="admin-section" style="display: none;">
                <h2 class="admin-heading">Manage Subjects</h2>
                <div class="loader" id="subjects-loader"></div>
                <div class="glass-block upload-form-container">
                    <h3>Add New Subject</h3>
                    <form id="add-subject-form">
                        <div class="input-group">
                            <label for="subject-name">Subject Name:</label>
                            <input type="text" id="subject-name" placeholder="Enter subject name" required>
                            <div class="error-message" id="subject-name-error"></div>
                        </div>
                        <div class="input-group">
                            <label for="subject-category">Category:</label>
                            <select id="subject-category" required>
                                <option value="theory">Theory</option>
                                <option value="practical">Practical</option>
                            </select>
                        </div>
                        <button type="submit" class="neon-button">
                            <span class="button-text">Add Subject</span>
                            <div class="loader loader-inline" id="add-subject-loader" style="display: none;"></div>
                        </button>
                    </form>
                    <div id="subject-action-message"></div>
                </div>
                
                <div class="glass-block manage-notes-container">
                    <h3>Existing Subjects</h3>
                    <table class="notes-table">
                        <thead>
                            <tr>
                                <th>Subject Name</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subjects-table-body">
                            <!-- Subjects will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="cards" class="admin-section" style="display: none;">
                <h2 class="admin-heading">Card Manager</h2>
                <div class="loader" id="cards-loader"></div>
                <div class="glass-block upload-form-container">
                    <h3>Add New Card</h3>
                    <form id="add-card-form">
                        <div class="input-group">
                            <label for="card-title">Card Title:</label>
                            <input type="text" id="card-title" placeholder="Enter card title" required>
                            <div class="error-message" id="card-title-error"></div>
                        </div>
                        <div class="input-group">
                            <label for="card-url">Card URL:</label>
                            <input type="text" id="card-url" placeholder="Enter card URL" required>
                            <div class="error-message" id="card-url-error"></div>
                        </div>
                        <div class="input-group">
                            <label for="card-category">Category:</label>
                            <select id="card-category" required>
                                <option value="theory">Theory</option>
                                <option value="practical">Practical</option>
                            </select>
                        </div>
                        <button type="submit" class="neon-button">
                            <span class="button-text">Add Card</span>
                            <div class="loader loader-inline" id="add-card-loader" style="display: none;"></div>
                        </button>
                        <div class="success-message" id="card-action-message"></div>
                    </form>
                </div>

                <div class="glass-block manage-notes-container">
                    <h3>Existing Cards</h3>
                    <table class="notes-table">
                        <thead>
                            <tr>
                                <th>Card Title</th>
                                <th>URL</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cards-table-body">
                            <!-- Cards will be loaded here -->
                        </tbody>
                    </table>
                </div>            </section>
        </main>
    </div>

    <script src="assets/auth.js"></script>
    <script src="assets/notes.js"></script>
    <script src="assets/liquid-effect.js"></script>
    <script src="assets/admin.js"></script>
    
    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-modal-content">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this note? This action cannot be undone.</p>
            <div class="confirmation-modal-buttons">
                <button class="cancel-btn" id="cancel-delete">Cancel</button>
                <button class="confirm-btn" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            enforceAdmin(); // Restrict access to admin only

            const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
            const sections = document.querySelectorAll('.admin-section');
            const uploadForm = document.getElementById('upload-note-form');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    if (link.hash) {
                        e.preventDefault();
                        const targetId = link.hash.substring(1);
                        
                        sections.forEach(section => {
                            section.style.display = section.id === targetId ? 'block' : 'none';
                        });

                        navLinks.forEach(nav => nav.classList.remove('active'));
                        link.classList.add('active');

                        if (targetId === 'manage') {
                            loadManageNotesTable(); // Function to load notes in the manage section
                        } else if (targetId === 'subjects') {
                            loadSubjectsTable(); // Function to load subjects in the subjects section
                        }
                    }
                });
            });

            if (uploadForm) {
                uploadForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const subject = document.getElementById('subject-select').value;
                    const title = document.getElementById('note-title').value;
                    const file = document.getElementById('note-file').files[0];

                    if (subject && title && file) {
                        try {
                            await createNote(subject, title, file);
                            alert('Note uploaded successfully!');
                            uploadForm.reset(); // Clear the form
                        } catch (error) {
                            alert('Error uploading note: ' + error.message);
                        }
                    } else {
                        alert('Please fill all fields and select a file.');
                    }
                });
            }
        });
    </script>
</body>
</html>